datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

model Conversation {
  id        String    @id @default(uuid())
  userId    String?   @map("user_id")
  createdAt DateTime  @default(now()) @map("created_at")
  updatedAt DateTime  @default(now()) @updatedAt @map("updated_at")
  status    String    @default("active")
  messages  Message[]
  feedback  Feedback?

  @@index([userId])
  @@map("conversations")
}

model Message {
  id             String       @id @default(uuid())
  conversationId String       @map("conversation_id")
  createdAt      DateTime     @default(now()) @map("created_at")
  role           String
  content        String
  audioUrl       String?      @map("audio_url")
  conversation   Conversation @relation(fields: [conversationId], references: [id], onDelete: Cascade)

  @@index([conversationId])
  @@map("messages")
}

model Feedback {
  id                 String       @id @default(uuid())
  conversationId     String       @unique @map("conversation_id")
  createdAt          DateTime     @default(now()) @map("created_at")
  goodPoints         String       @map("good_points")
  improvementPoints  String       @map("improvement_points")
  overallScore       Int?         @map("overall_score")
  conversation       Conversation @relation(fields: [conversationId], references: [id], onDelete: Cascade)

  @@map("feedback")
}
